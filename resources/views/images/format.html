@extends('layouts.app') @section('header')
<style>
  .gallery-grid {
    display: grid;
    gap: 1rem;
    grid-template-columns: repeat(3, 1fr);
    grid-auto-rows: auto;
    grid-auto-flow: dense;
  }
  @media (min-width: 50rem) {
    .gallery-grid {
      grid-template-columns: repeat(4, 1fr);
      grid-auto-rows: auto;
    }
  }
  .gallery-itme-wide {
    grid-column: auto/span 2;
  }
  .gallery-itme-tall {
    grid-row: auto/span 2;
  }
  .grid-image {
    object-fit: cover;
    display: block;
    width: 100%;
    height: 100%;
    transition: 0.1s;
  }
  .grid-image:hover {
    filter: brightness(90%);
  }
</style>
@endsection @section('content')
<section class="flex justify-center mt-8 pt-8">
  <div>
    <div id="image-container" class="p-4 gallery-grid"></div>
    <div id="bottom"></div>
  </div>
</section>
@endsection @section('javascript')
<script>
  document.addEventListener('DOMContentLoaded', function() {
    var bottom = document.getElementById('bottom')
    var nextPage = '/api/images'

    var imageObserver = new IntersectionObserver(function(entries, observer) {
      currentBottomOffset = bottom.offsetTop < 100 ? 0 : bottom.offsetTop

      entries.forEach(function(entry) {
        if (entry.isIntersecting && nextPage !== null) {
          fetch(nextPage, {
            headers: {
              Accept: 'application/json',
            },
          })
            .then(response => response.json())
            .then(result => {
              console.log(result.images)
              result.images.data.forEach(image => {
                console.log(image)

                let div = document.createElement('div')
                div.classList.add('h-full')
                if (image.id % 4 === 0) {
                  div.classList.add('gallery-itme-wide')
                } else if (image.id % 4 === 1) {
                  div.classList.add('gallery-itme-tall')
                } else if (image.id % 4 === 2) {
                  div.classList.add('gallery-itme-wide', 'gallery-item-tall')
                }
                let img = document.createElement('img')
                img.setAttribute('src', '/storage/' + image.filename)
                img.classList.add('grid-image')
                div.appendChild(img)
                document.getElementById('image-container').appendChild(div)
              })

              window.scrollTo(0, currentBottomOffset)
              nextPage = result.images.next_page_url
            })
        }
      })
    })

    imageObserver.observe(bottom)
  })
</script>
@endsection
